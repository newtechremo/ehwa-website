# 도메인 연결 현황 보고서

**작성일:** 2026년 1월 5일
**최종 업데이트:** 2026년 1월 5일 15:30 KST
**상태:** DNS CNAME 값 변경 요청 필요

---

## 1. 현재 도메인 연결 상태

| 도메인 | 상태 | 비고 |
|--------|------|------|
| https://remo-test.online/ | ✅ **정상 작동** | 기존 테스트 도메인 |
| https://barrierfree.eumc.ac.kr/ | ❌ **연결 실패** | DNS CNAME 값 변경 필요 |

---

## 2. 문제 원인 분석

### 2.1 DNS 해석 비교

| 도메인 | DNS 해석 결과 | 상태 |
|--------|--------------|------|
| remo-test.online | 104.21.91.235, 172.67.181.233 (Cloudflare IP) | ✅ 공개 IP 반환 |
| cfargotunnel.com | (A 레코드 없음, IPv6 사설 주소만) | ❌ 공개 IP 없음 |

### 2.2 현재 DNS 설정의 문제

```
barrierfree.eumc.ac.kr
         │
         ▼ CNAME
49a156c2-21fd-4962-a01c-b09892255da6.cfargotunnel.com
         │
         ▼ DNS 해석
❌ 공개 IP 없음 (사설 IPv6: fd10:aec2:5dae:: 만 반환)
         │
         ▼
연결 실패: "Couldn't connect to server"
```

**핵심 원인:** `cfargotunnel.com` 도메인은 Cloudflare 내부 라우팅용으로만 사용되며, 외부에서 접근 가능한 공개 IP 주소를 반환하지 않습니다.

---

## 3. 서버 측 설정 현황 (모두 완료)

### 3.1 Cloudflared 설정 ✅
**파일:** `/etc/cloudflared/config.yml`

```yaml
tunnel: remo-tunnel

credentials-file: /home/finefit-temp/.cloudflared/49a156c2-21fd-4962-a01c-b09892255da6.json

ingress:
  - hostname: remo-test.online
    service: http://localhost:3111
  - hostname: barrierfree.eumc.ac.kr      # ✅ 추가 완료
    service: http://localhost:3111
  - service: http_status:404
```

### 3.2 Nginx 설정 ✅
**파일:** `/etc/nginx/sites-available/remo-test.online`

```nginx
server {
    listen 3111;
    server_name remo-test.online www.remo-test.online barrierfree.eumc.ac.kr;  # ✅ 추가 완료

    location / {
        proxy_pass http://localhost:3112;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 3.3 Cloudflare Zero Trust Public Hostname ✅

Cloudflare Zero Trust 대시보드에서 `barrierfree.eumc.ac.kr` Public Hostname 등록 완료

---

## 4. 작업 완료 현황

| 단계 | 작업 내용 | 상태 | 담당 |
|------|----------|------|------|
| 1 | DNS CNAME 설정 (cfargotunnel.com) | ✅ 완료 | 병원 전산팀 |
| 2 | cloudflared ingress 규칙 추가 | ✅ 완료 | 서버 관리자 |
| 3 | Nginx server_name 추가 | ✅ 완료 | 서버 관리자 |
| 4 | Cloudflare Zero Trust Public Hostname 등록 | ✅ 완료 | 서버 관리자 |
| 5 | **DNS CNAME 값 변경 (remo-test.online)** | ⏳ **요청 필요** | 병원 전산팀 |

---

## 5. 해결 방법: DNS CNAME 값 변경 요청

### 5.1 변경 내용

| 항목 | 변경 전 | 변경 후 |
|------|--------|--------|
| 레코드 타입 | CNAME | CNAME (동일) |
| Host | barrierfree | barrierfree (동일) |
| **값** | `49a156c2-21fd-4962-a01c-b09892255da6.cfargotunnel.com` | **`remo-test.online`** |

### 5.2 왜 이렇게 변경해야 하는가?

```
변경 후 예상 트래픽 흐름:

barrierfree.eumc.ac.kr
         │
         ▼ CNAME
remo-test.online
         │
         ▼ A 레코드
104.21.91.235 (Cloudflare Proxy IP) ✅
         │
         ▼ Cloudflare가 Host 헤더 확인
Host: barrierfree.eumc.ac.kr
         │
         ▼ Public Hostname 등록됨 (Zero Trust)
Cloudflare Tunnel (remo-tunnel)
         │
         ▼ ingress 규칙 매칭
cloudflared → localhost:3111
         │
         ▼ Nginx proxy_pass
localhost:3112 (Next.js)
         │
         ▼
✅ 정상 응답
```

### 5.3 전산팀 전달용 메시지

```
안녕하세요,

기존 barrierfree.eumc.ac.kr DNS 설정에서 CNAME 값 변경이 필요합니다.

■ 변경 요청
  - 레코드 타입: CNAME
  - Host: barrierfree
  - 기존 값: 49a156c2-21fd-4962-a01c-b09892255da6.cfargotunnel.com
  - 변경 값: remo-test.online

■ 변경 사유
  cfargotunnel.com 도메인이 공개 IP 주소를 반환하지 않아
  외부에서 접속이 불가능합니다.
  remo-test.online은 Cloudflare Proxy IP를 정상적으로 반환하므로
  이 값으로 변경하면 연결이 가능합니다.

감사합니다.
```

---

## 6. 서버 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              인터넷 (사용자)                                  │
└────────────────────────────────────┬────────────────────────────────────────┘
                                     │
                    ┌────────────────┴────────────────┐
                    ▼                                 ▼
        ┌───────────────────┐             ┌───────────────────┐
        │ remo-test.online  │             │barrierfree.eumc.ac.kr│
        │     ✅ 작동       │             │    ❌ DNS 변경 필요  │
        └─────────┬─────────┘             └─────────┬─────────┘
                  │                                 │
                  │    ┌────────────────────────────┘
                  │    │ (CNAME → remo-test.online 으로 변경 후)
                  ▼    ▼
        ┌─────────────────────────────────────────────────────┐
        │         Cloudflare Proxy (104.21.91.235)            │
        └─────────────────────────┬───────────────────────────┘
                                  │
                                  ▼
        ┌─────────────────────────────────────────────────────┐
        │              Cloudflare Tunnel (remo-tunnel)         │
        │          ID: 49a156c2-21fd-4962-a01c-b09892255da6    │
        └─────────────────────────┬───────────────────────────┘
                                  │
                                  ▼
        ┌─────────────────────────────────────────────────────┐
        │              로컬 서버 (finefittemp-desktop)         │
        │  ┌───────────────────────────────────────────────┐  │
        │  │         cloudflared (Tunnel Client)           │  │
        │  │              서비스 상태: ✅ 실행 중            │  │
        │  └─────────────────────┬─────────────────────────┘  │
        │                        │                            │
        │                        ▼                            │
        │  ┌───────────────────────────────────────────────┐  │
        │  │              Nginx (포트 3111)                 │  │
        │  │              서비스 상태: ✅ 실행 중            │  │
        │  └─────────────────────┬─────────────────────────┘  │
        │                        │                            │
        │                        ▼                            │
        │  ┌───────────────────────────────────────────────┐  │
        │  │          Next.js 앱 (포트 3112)               │  │
        │  │         이대목동병원 장애인 이용편의 지원센터    │  │
        │  └───────────────────────────────────────────────┘  │
        └─────────────────────────────────────────────────────┘
```

---

## 7. 검증 방법 (DNS 변경 후)

```bash
# 1. DNS 확인
dig barrierfree.eumc.ac.kr +short
# 예상: remo-test.online. 또는 104.21.91.235

# 2. HTTP 연결 테스트
curl -I https://barrierfree.eumc.ac.kr/
# 예상: HTTP/2 200

# 3. 브라우저 접속
# https://barrierfree.eumc.ac.kr/ 접속 확인
```

---

## 8. 관련 파일 경로

| 파일 | 경로 |
|------|------|
| Cloudflared 설정 | `/etc/cloudflared/config.yml` |
| Nginx 설정 | `/etc/nginx/sites-available/remo-test.online` |
| Cloudflared 자격증명 | `/home/finefit-temp/.cloudflared/49a156c2-21fd-4962-a01c-b09892255da6.json` |
| Cloudflared 서비스 | `/etc/systemd/system/cloudflared.service` |

---

## 9. 요약

| 구분 | 항목 | 상태 |
|------|------|------|
| 서버 설정 | cloudflared ingress | ✅ 완료 |
| 서버 설정 | Nginx server_name | ✅ 완료 |
| 서버 설정 | Cloudflare Zero Trust Public Hostname | ✅ 완료 |
| **DNS 설정** | **CNAME 값 변경 (→ remo-test.online)** | ⏳ **요청 필요** |

**다음 단계:** 병원 전산팀에 DNS CNAME 값 변경 요청

---

**최종 업데이트:** 2026년 1월 5일 15:30 KST
